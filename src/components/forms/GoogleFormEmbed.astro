---
interface Props {
  formUrl: string;
  title?: string;
  height?: string;
}

const { 
  formUrl, 
  title = 'Order Form',
  height = '800px'
} = Astro.props;

// Ensure the URL is the embed version
const embedUrl = formUrl.includes('/viewform') 
  ? formUrl.replace('/viewform', '/viewform?embedded=true')
  : formUrl;
---

<div class="form-container">
  <div class="form-loading" aria-hidden="true">
    <div class="loading-spinner"></div>
    <p>Loading form...</p>
  </div>
  <iframe
    src={embedUrl}
    title={title}
    width="100%"
    height={height}
    frameborder="0"
    marginheight="0"
    marginwidth="0"
    loading="lazy"
    onload="this.parentElement.querySelector('.form-loading').style.display='none'"
  >
    Loadingâ€¦
  </iframe>
</div>

<style>
  .form-container {
    position: relative;
    background: var(--white);
    border-radius: 16px;
    overflow: hidden;
    box-shadow: var(--shadow-soft);
    max-width: 800px;
    margin: 0 auto;
  }
  
  .form-loading {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: var(--white);
    z-index: 1;
    gap: var(--space-md);
    color: var(--warm-gray);
  }
  
  .loading-spinner {
    width: 40px;
    height: 40px;
    border: 3px solid var(--sage-light);
    border-top-color: var(--sage);
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }
  
  @keyframes spin {
    to { transform: rotate(360deg); }
  }
  
  iframe {
    display: block;
    border: none;
  }
  
  @media (max-width: 768px) {
    .form-container {
      border-radius: 0;
      box-shadow: none;
      margin: 0 calc(-1 * var(--space-md));
    }
  }
</style>
