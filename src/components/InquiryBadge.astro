---
/**
 * InquiryBadge - Shows cart count in navbar
 * 
 * Displays a small sage badge with the number of items in the inquiry cart.
 * Updates dynamically when items are added/removed.
 */
---

<a href="/order/" class="inquiry-badge-link" aria-label="View inquiry cart">
  <svg class="inquiry-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
    <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M9 12h6M9 16h6" stroke-linecap="round"/>
  </svg>
  <span class="inquiry-badge" id="inquiry-badge-count" style="display: none;">0</span>
</a>

<style>
  .inquiry-badge-link {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.5rem;
    color: var(--charcoal, #2C2C2C);
    text-decoration: none;
    position: relative;
    transition: color 0.2s ease;
  }

  .inquiry-badge-link:hover {
    color: var(--sage, #8FA378);
  }

  .inquiry-icon {
    width: 24px;
    height: 24px;
  }

  .inquiry-badge {
    position: absolute;
    top: 0;
    right: -2px;
    background: var(--sage, #8FA378);
    color: white;
    font-size: 0.7rem;
    font-weight: 600;
    min-width: 18px;
    height: 18px;
    border-radius: 9px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0 4px;
    font-family: var(--font-body, Inter, sans-serif);
  }

  /* Pulse animation when item is added */
  .inquiry-badge.pulse {
    animation: badge-pulse 0.3s ease-out;
  }

  @keyframes badge-pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.3); }
    100% { transform: scale(1); }
  }
</style>

<script>
  import { getCount } from '../scripts/inquiry-store';

  function updateBadge() {
    const badge = document.getElementById('inquiry-badge-count');
    if (!badge) return;

    const count = getCount();
    
    if (count > 0) {
      badge.textContent = count > 99 ? '99+' : count.toString();
      badge.style.display = 'flex';
      // Trigger pulse animation
      badge.classList.remove('pulse');
      void badge.offsetWidth; // Force reflow
      badge.classList.add('pulse');
    } else {
      badge.style.display = 'none';
    }
  }

  // Update on page load
  document.addEventListener('DOMContentLoaded', updateBadge);

  // Update when cart changes (custom event from inquiry-store)
  window.addEventListener('inquiry-cart-updated', updateBadge);

  // Also check on visibility change (user returns to tab)
  document.addEventListener('visibilitychange', () => {
    if (document.visibilityState === 'visible') {
      updateBadge();
    }
  });
</script>
